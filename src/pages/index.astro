---
import Layout from "../layouts/Layout.astro";
import ProfileCard from "../components/ProfileCard.svelte";
import TechStack from "../components/TechStack.svelte";
import Projects from "../components/Projects.svelte";
---

<script>
  import { uiState } from "../lib/ui.svelte";

  // Intersection Observer to update active section
  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.5, // Trigger when 50% of the section is visible
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        uiState.setActiveSection(entry.target.id);
      }
    });
  }, observerOptions);

  document.querySelectorAll("section").forEach((section) => {
    observer.observe(section);
  });
</script>

<Layout>
  <div
    class="snap-y snap-proximity md:snap-mandatory h-screen overflow-y-scroll scroll-smooth pb-20 md:pb-0"
  >
    <section
      id="profile"
      class="snap-start h-screen w-full flex items-center justify-center p-4"
    >
      <ProfileCard client:load />
    </section>

    <section
      id="stack"
      class="snap-start min-h-screen w-full flex items-center justify-center p-4 bg-base-200/50 py-20 md:py-0"
    >
      <TechStack client:visible />
    </section>

    <section
      id="projects"
      class="snap-start min-h-screen w-full flex items-center justify-center p-4 py-20 md:py-0"
    >
      <Projects client:visible />
    </section>
  </div>
</Layout>
